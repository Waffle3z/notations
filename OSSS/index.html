<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta http-equiv="cache-control" content="no-cache">
	<meta http-equiv="expires" content="0">
	<meta http-equiv="pragma" content="no-cache">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" type="text/css" href="../styles.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/firacode/6.2.0/fira_code.css" />
	<title>OSSS</title>
	<style>
		#container {
			display: flex;
			flex-direction: row;
			padding: 20px;
			gap: 20px;
		}

		#settings {
			width: 320px;
		}

		fieldset {
			border: 1px solid #555;
			padding: 10px;
			margin-bottom: 15px;
		}

		legend {
			padding: 0 5px;
			color: #ccc;
		}

		label {
			display: block;
			margin-bottom: 6px;
			font-size: 14px;
		}

		textarea, input[type="text"] {
			width: 100%;
			box-sizing: border-box;
			padding: 6px;
			background-color: #111;
			border: 1px solid #555;
			color: #eee;
			font-family: "Fira Code", monospace;
			font-size: 13px;
			resize: vertical;
		}

		button {
			background: #474747;
			border-radius: 4px;
			color: #eee;
			border: none;
			padding: 6px 10px;
			cursor: pointer;
			margin-right: 6px;
			font-size: 13px;
		}

		button:hover {
			background: #5a5a5a;
		}

		#output-container {
			flex: 1;
			display: flex;
			flex-direction: column;
			gap: 10px;
			min-width: 0;
		}

		.label-inline {
			display: inline-block;
			min-width: 70px;
			color: #ccc;
			font-size: 13px;
		}

		#error {
			color: #ff6666;
			font-size: 13px;
			min-height: 16px;
			white-space: pre-wrap;
		}

		@media (max-width: 900px) {
			#container {
				flex-direction: column;
			}
			#settings {
				width: 100%;
			}
		}
	</style>
</head>
<body>
	<div id="container">
		<div id="settings">
			<fieldset>
				<legend>Input</legend>
				<textarea id="input" rows="8">
(0)(0,1)(0,2)(0,3)
(0)(0,1)(0,2)(0,1,3)
(0)(0,1)(0,1,2)
()()(1)(2,1)(3,2,1)
()()(1)(2)(3,1)
()()(1)(1)(1)</textarea>
		</fieldset>
		<label>
			<input type="checkbox" id="numbersCheckbox" checked="true"> Numbers
		</label>
		<label>
			Cell Size:<span id="cellSizeValue" style="display: inline-block; width: 20px; text-align: right;">16</span>px <input type="range" id="cellSize" value="16" min="8" max="32" step="1" style="vertical-align: middle;">
		</label>

		<div id="error"></div>
		</div>

		<div id="output-container">
			<div id="results"></div>
		</div>
	</div>

	<script src="logic.js"></script>
	<script>
		function renderAll() {
			const inputEl = document.getElementById("input");
			const numbersCheckboxEl = document.getElementById("numbersCheckbox");
			const errEl = document.getElementById("error");
			const resultsEl = document.getElementById("results");

			errEl.textContent = "";
			resultsEl.innerHTML = "";

			const showNumbers = numbersCheckboxEl ? numbersCheckboxEl.checked : true;
			const cellSizeEl = document.getElementById("cellSize");
			const cellSize = parseInt(cellSizeEl.value) || 12;
			const blocks = [];

			const lines = inputEl.value.split(/\r?\n/);
			lines.forEach((line, index) => {
				const trimmed = line.trim();
				if (!trimmed) return;

				const block = document.createElement("div");
				block.style.marginBottom = "16px";

				if (blocks.length > 0) {
					const separator = document.createElement("div");
					separator.style.borderTop = "1px solid #444";
					separator.style.margin = "10px 0";
					block.appendChild(separator);
				}

				const header = document.createElement("div");
				header.className = "output-line";
				block.appendChild(header);

				try {
					let matrix = matrixFromString(trimmed);
					let blockList = blockListFromString(trimmed);
					const drawn = drawArray(matrix, showNumbers);

					const invDiv = document.createElement("div");
					invDiv.className = "output-line";
					const invLabel = document.createElement("span");
					invLabel.className = "label-inline";
					invLabel.textContent = "Block list:";
					const invVal = document.createElement("span");
					invVal.textContent = arrayToString(blockList);
					header.textContent = arrayToString(matrix);
					invDiv.appendChild(invLabel);
					invDiv.appendChild(invVal);
					block.appendChild(invDiv);

					const gridContainer = document.createElement("div");
					gridContainer.style.backgroundColor = "#111";
					gridContainer.style.border = "1px solid #555";
					gridContainer.style.padding = "8px";
					gridContainer.style.overflowX = "auto";
					gridContainer.style.display = "inline-block";
					gridContainer.style.userSelect = "text";
					gridContainer.style.position = "relative";
					const rows = drawn.split("\n");
					rows.forEach(row => {
						const rowDiv = document.createElement("div");
						rowDiv.style.display = "flex";
						for (let char of row) {
							const cell = document.createElement("span");
							cell.style.display = "inline-block";
							cell.style.width = cellSize + 'px';
							cell.style.height = cellSize + 'px';
							cell.style.fontFamily = '"Fira Code", monospace';
							cell.style.fontSize = (cellSize * 0.8) + 'px';
							cell.style.lineHeight = cellSize + 'px';
							cell.style.textAlign = "center";
							cell.style.verticalAlign = "middle";
							cell.style.color = "#eee";
							cell.style.userSelect = "text";
							if (char === "â–ˆ") {
								cell.style.backgroundColor = "#fff";
								cell.textContent = "â–ˆ";
								cell.style.color = "transparent";
							} else {
								cell.textContent = char;
							}
							rowDiv.appendChild(cell);
						}
						gridContainer.appendChild(rowDiv);
					});
					const copyButton = document.createElement("button");
					copyButton.textContent = "ðŸ“‹";
					copyButton.style.position = "absolute";
					copyButton.style.top = "5px";
					copyButton.style.right = "0px";
					copyButton.style.background = "#333";
					copyButton.style.color = "#eee";
					copyButton.style.border = "none";
					copyButton.style.cursor = "pointer";
					copyButton.style.fontSize = "12px";
					copyButton.style.padding = "2px 2px";
					copyButton.style.opacity = "0";
					copyButton.style.transition = "opacity 0.1s";
					copyButton.addEventListener("click", () => {
						navigator.clipboard.writeText(drawn).catch(err => console.error('Copy failed', err));
					});
					copyButton.addEventListener("mousedown", () => copyButton.style.background = "#555");
					copyButton.addEventListener("mouseup", () => copyButton.style.background = "#333");
					copyButton.addEventListener("mouseenter", () => copyButton.style.background = "#444");
					copyButton.addEventListener("mouseleave", () => copyButton.style.background = "#333");
					gridContainer.addEventListener("mouseenter", () => copyButton.style.opacity = "1");
					gridContainer.addEventListener("mouseleave", () => copyButton.style.opacity = "0");
					gridContainer.appendChild(copyButton);
					block.appendChild(gridContainer);
				} catch (e) {
					const errLine = document.createElement("div");
					errLine.className = "output-line";
					errLine.style.color = "#ff6666";
					errLine.textContent = "Error on line " + (index + 1) + ": " + e.message;
					block.appendChild(errLine);
				}

				blocks.push(block);
			});

			blocks.forEach(block => resultsEl.appendChild(block));
		}

		document.getElementById("input").addEventListener("input", () => {
			try {
				renderAll();
			} catch (e) {
				const errEl = document.getElementById("error");
				errEl.textContent = "Unexpected error: " + e.message;
			}
		});

		document.getElementById("numbersCheckbox").addEventListener("change", () => {
			try {
				renderAll();
			} catch (e) {
				const errEl = document.getElementById("error");
				errEl.textContent = "Unexpected error: " + e.message;
			}
		});

		document.getElementById("cellSize").addEventListener("input", () => {
			document.getElementById("cellSizeValue").textContent = document.getElementById("cellSize").value;
			try {
				renderAll();
			} catch (e) {
				const errEl = document.getElementById("error");
				errEl.textContent = "Unexpected error: " + e.message;
			}
		});

		window.addEventListener("DOMContentLoaded", () => {
			document.getElementById("cellSizeValue").textContent = document.getElementById("cellSize").value;
			try {
				renderAll();
			} catch (e) {
				const errEl = document.getElementById("error");
				errEl.textContent = "Unexpected error: " + e.message;
			}
		});
	</script>
	<div id="footer">
		<a href="../">Index</a>
	</div>
</body>
</html>
